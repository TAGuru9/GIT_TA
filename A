SELECT  
    YEAR(RN_EXECUTION_DATE) AS YEAR,
    MONTH(RN_EXECUTION_DATE) AS MONTH,
    RN_TESTER_NAME AS RESOURCE,
    
    -- Automation Count
    SUM(CASE WHEN RN_TEST_TYPE = 'AUTOMATED' THEN 1 ELSE 0 END) AS Automation_Run_Cnt,
    
    -- Manual Count
    SUM(CASE WHEN RN_TEST_TYPE <> 'AUTOMATED' THEN 1 ELSE 0 END) AS Manual_Run_Cnt,
    
    -- Total
    COUNT(*) AS Total_Run_Cnt,
    
    -- Automation %
    CASE 
        WHEN COUNT(*) = 0 THEN 0
        ELSE ROUND((CAST(SUM(CASE WHEN RN_TEST_TYPE = 'AUTOMATED' THEN 1 END) AS FLOAT) 
                   / COUNT(*)) * 100, 2)
    END AS Automation_Percentage
FROM amfc_isqat_db.td.run
GROUP BY  
    YEAR(RN_EXECUTION_DATE),
    MONTH(RN_EXECUTION_DATE),
    RN_TESTER_NAME
ORDER BY  
    YEAR,
    MONTH,
    RESOURCE;

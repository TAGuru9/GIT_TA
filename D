DECLARE @Year INT = YEAR(GETDATE());   -- or set e.g. = 2025

SELECT
    ISNULL(T.TS_USER_03, '(No Application)') AS Application,

    SUM(CASE 
            WHEN T.TS_NAME LIKE 'TA\_%' ESCAPE '\' THEN 1 
            ELSE 0 
        END) AS Automated_Count,

    SUM(CASE 
            WHEN T.TS_NAME NOT LIKE 'TA\_%' ESCAPE '\' THEN 1 
            ELSE 0 
        END) AS Manual_Count,

    COUNT(*) AS Total_Count,

    CAST(
        100.0 * SUM(CASE 
                        WHEN T.TS_NAME LIKE 'TA\_%' ESCAPE '\' THEN 1 
                        ELSE 0 
                    END)
        / NULLIF(COUNT(*), 0)
        AS DECIMAL(5,2)
    ) AS Automation_Pct
FROM [amfc_isqat_db].[td].[TEST] T
WHERE YEAR(T.TS_CREATION_DATE) = @Year      -- filter to this year
GROUP BY ISNULL(T.TS_USER_03, '(No Application)')
ORDER BY Application;
